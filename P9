#include<stdio.h>
#include<stdlib.h>
#include<math.h>

struct node {
	int cf,px,py,pz;
	int flag;
	struct node *link;
};

typedef struct node NODE;
NODE *getnode() {
	NODE *x;
	x=(NODE *)malloc(sizeof(NODE));
	
	if(x==NULL) {
		printf("Insufficient memory.\n");
		exit(0);
	}
	x->flag=0;
	return x;
}

NODE *insert_rear(int cf,int x,int y,int z,NODE *head) {
	NODE *temp=getnode();
	NODE *cur;

	temp->cf=cf;
	temp->px=x;
	temp->py=y;
	temp->pz=z;

	cur=head;
	while(cur->link!=head){
		cur=cur->link;
	}
	cur->link=temp;
	temp->link=head;
	return head;
}

NODE *read_poly(NODE *head) {
	int cf,px,py,pz,ch;

	do {
		printf("Enter coefficient: ");
		scanf("%d",&cf);
		printf("Enter x,y and z powers: ");
		scanf("%d %d %d",&px,&py,&pz);

		head=insert_rear(cf,px,py,pz,head);
		printf("If you wish to continue press 1 otherwise 0: ");
		scanf("%d", &ch);
	} while(ch!=0);
	return head;
}

void display(NODE *head) {
	NODE *temp=head->link;

	if(temp==head) {
		printf("Polynomial does not exist.\n");
		return;
	}

	printf("\nThe polynomial is:\n");
	while(temp!=head) {
		printf("%d x^%d y^%d z^%d",temp->cf,temp->px,temp->py,temp->pz);
		if(temp->link!=head)
			printf(" + ");
			temp=temp->link;
	}
	printf("\n");
}

NODE *add_poly(NODE *h1,NODE *h2,NODE *h3) {
	NODE *p1=h1->link,*p2;

	while(p1!=h1) {
		p2=h2->link;
		while(p2!=h2) {
			if(p1->px==p2->px && p1->py==p2->py && p1->pz==p2->pz) {
				h3=insert_rear(p1->cf+p2->cf,p1->px,p1->py,p1->pz,h3);
				p2->flag=1;
				break;
			}
			p2=p2->link;
		}
		if(p2==h2)
			h3=insert_rear(p1->cf,p1->px,p1->py,p1->pz,h3);
		p1=p1->link;
	}

	p2=h2->link;
	while(p2!=h2) {
		if(p2->flag==0)
			h3=insert_rear(p2->cf,p2->px,p2->py,p2->pz,h3);
		p2=p2->link;
	}
	return h3;
}

void evaluate(NODE *head) {
	NODE *p=head->link;
	int x,y,z;
	float result=0;

	printf("Enter x,y and z values: ");
	scanf("%d %d %d",&x,&y,&z);

	while(p!=head) {
		result+=p->cf*pow(x,p->px)*pow(y,p->py)*pow(z,p->pz);
		p=p->link;
	}
	printf("Polynomial result: %f\n",result);
}

void main() {
	NODE *h1,*h2,*h3;
	int ch;

	h1=getnode();
	h2=getnode();
	h3=getnode();

	h1->link=h1;
	h2->link=h2;
	h3->link=h3;

	while(1) {
		printf("---MAIN MENU---");
		printf("\n1. Evaluate Polynomial\n2. Add Polynomials\n3. Exit\n");
		printf("Enter your choice: ");
		scanf("%d", &ch);

		switch(ch) {
			case 1:h1=read_poly(h1);
				display(h1);
				evaluate(h1);
				break;

			case 2:printf("Enter first polynomial\n");
				h1=read_poly(h1);
				printf("Enter second polynomial\n");
				h2=read_poly(h2);
				h3=add_poly(h1,h2,h3);
				printf("\nThe first polynomial is: \n");
				display(h1);
				printf("The second polynomial is: \n");
				display(h2);
				printf("Resultant polynomial:\n");
				display(h3);
				break;

			case 3:exit(0);
			default:printf("Invalid choice.\n");
		}
	}
}
